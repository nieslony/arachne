<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <p:dialog header="Acces from where"
              dynamic="true"
              id="dlgEditWhere"
              widgetVar="dlgEditWhere">
        <p:selectOneRadio value="#{editFirewallEntry.editWhere.whereType}"
                          layout="custom"
                          id="whereType">
            <f:selectItem itemValue="Everywhere"/>
            <f:selectItem itemValue="Hostname"/>
            <f:selectItem itemValue="Network"/>
            <f:ajax render="hostname network mask"/>
        </p:selectOneRadio>
        
        <h:panelGrid columns="3">
            <p:radioButton for="whereType" itemIndex="0" id="rbEverywhere"/>
            <p:outputLabel for="rbEverywhere" value="Everywhere"/>
            <h:outputText value=""/>
            
            <p:radioButton for="whereType" itemIndex="1" id="rbHostname"/>
            <p:outputLabel for="rbHostname" value="Hostname:"/>
            <p:inputText value="#{editFirewallEntry.editWhere.hostname}" id="hostname"
                         disabled='#{editFirewallEntry.editWhere.whereType != "Hostname"}'/>
            
            <p:radioButton for="whereType" itemIndex="2" id="rbNetwork"/>
            <p:outputLabel for="rbNetwork" value="Network:"/>
            <p:outputPanel>
                <p:inputText value="#{editFirewallEntry.editWhere.network}" id="network"
                             disabled='#{editFirewallEntry.editWhere.whereType != "Network"}'/>
                <h:outputText value="/"/>
                <p:spinner min="1" max="65535" value="#{editFirewallEntry.editWhere.mask}"
                           id="mask"
                           disabled='#{editFirewallEntry.editWhere.whereType != "Network"}'/>
            </p:outputPanel>
        </h:panelGrid>
        
        <p:commandButton value="OK" action="#{editFirewallEntry.editWhere.onOk}" update="what dlgEditWhat"/>
        <p:commandButton value="Cancel" action="#{editFirewallEntry.editWhere.onCancel}"/>        
    </p:dialog>
    
    <p:dialog header="Access what"
              dynamic="true"
        id="dlgEditWhat"
        onShow="#{editWhat.onShow()}"
        widgetVar="dlgEditWhat"
        >
        <p:selectOneRadio value="#{editFirewallEntry.editWhat.type}"
                          layout="custom"
                          id="whatType">
            <f:selectItem itemValue="Everything" />
            <f:selectItem itemLabel="Service" itemValue="Service"/>
            <f:selectItem itemValue="PortProtocol"/>
            <f:selectItem itemValue="PortRangeProtocol"/>
            <f:selectItem itemValue="PortListProtocol"/>
            <f:ajax render="service portProtocol portRangeProtocol portListProtocol"/>
        </p:selectOneRadio>

        <h:panelGrid columns="3">
            <p:radioButton for="whatType" itemIndex="0" id="rbEverything"/>
            <p:outputLabel for="rbEverything" value="Everything"/>
            <h:outputText value=""/>

            <p:radioButton for="whatType" itemIndex="1" id="rbService"/>
            <p:outputLabel for="rbService" value="Service"/>
            <p:selectOneMenu disabled='#{editFirewallEntry.editWhat.type != "Service"}'
                             id="service"
                             converter="firewallDServiceConverter"
                             value="#{editFirewallEntry.editWhat.service}"
                             >
                <f:selectItems value="#{firewallDServices.services}"
                               var="s"
                               itemLabel="#{s.shortDescription}"
                               itemValue="#{s}"
                               />
            </p:selectOneMenu>

            <p:radioButton for="whatType" itemIndex="2" id="rbPortProtocol"/>
            <p:outputLabel for="rbPortProtocol" value="Port and Protocol"/>
            <p:outputPanel id="portProtocol">
                <p:spinner min="1" max="65535" size="5"
                           disabled='#{editFirewallEntry.editWhat.type != "PortProtocol"}'
                           value="#{editFirewallEntry.editWhat.port}"/>
                <h:outputText value=" / "/>
                <p:selectOneMenu value="#{editFirewallEntry.editWhat.protocol}"
                                 disabled='#{editFirewallEntry.editWhat.type != "PortProtocol"}' >
                    <f:selectItem itemLabel="Tcp" itemValue="TCP"/>
                    <f:selectItem itemLabel="Udp" itemValue="UDP"/>
                </p:selectOneMenu>
            </p:outputPanel>

            <p:radioButton for="whatType" itemIndex="3" id="rbPortRangeProtocol"/>
            <p:outputLabel for="rbPortRangeProtocol" value="Port range and protocol"/>
            <p:outputPanel id="portRangeProtocol">
                <p:spinner min="1" max="65535" size="5"
                           disabled='#{editFirewallEntry.editWhat.type != "PortRangeProtocol"}'
                           value="#{editFirewallEntry.editWhat.portFrom}"/>
                <h:outputText value=" - "/>
                <p:spinner min="1" max="65535" size="5"
                           disabled='#{editFirewallEntry.editWhat.type != "PortRangeProtocol"}'
                           value="#{editFirewallEntry.editWhat.portTo}"/>
                <h:outputText value=" / "/>
                <p:selectOneMenu value="#{editFirewallEntry.editWhat.protocol}"
                                 disabled='#{editFirewallEntry.editWhat.type != "PortRangeProtocol"}'>
                    <f:selectItem itemLabel="Tcp" itemValue="TCP"/>
                    <f:selectItem itemLabel="Udp" itemValue="UDP"/>
                </p:selectOneMenu>
            </p:outputPanel>

            <p:radioButton for="whatType" itemIndex="4" id="rbPortListProtocol"/>
            <p:outputLabel for="rbPortListProtocol" value="Port list and Protocol"/>
            <p:outputPanel id="portListProtocol">
                <p:chips value="#{editFirewallEntry.editWhat.ports}"
                         disabled='#{editFirewallEntry.editWhat.type != "PortListProtocol"}'/>
                <h:outputText value=" / "/>
                <p:selectOneMenu value="#{editFirewallEntry.editWhat.protocol}"
                                 disabled='#{editFirewallEntry.editWhat.type != "PortListProtocol"}'>
                    <f:selectItem itemLabel="Tcp" itemValue="TCP"/>
                    <f:selectItem itemLabel="Udp" itemValue="UDP"/>
                </p:selectOneMenu>
            </p:outputPanel>
        </h:panelGrid>

        <p:commandButton value="OK" action="#{editFirewallEntry.editWhat.onOk}" update="what dlgEditWhat"/>
        <p:commandButton value="Cancel" action="#{editFirewallEntry.editWhat.onCancel}"/>
    </p:dialog>

    <p:dialog header="#{editFirewallSettings.editingMode} #{editFirewallSettings.editingChain} chain"
              id="dlgEditFirewallEntry"
              widgetVar="dlgEditFirewallEntry">
        <h:panelGrid columns="2">
                <p:outputLabel value="Label:" for="label"/>
                <p:inputText value="#{editFirewallEntry.label}"
                             id="label"/>

                <p:outputLabel value="Description:"/>
                <p:inputText value="#{editFirewallEntry.description}"
                             id="description"/>

                <p:outputLabel value="Is active:" for="isActive"/>
                <p:inputSwitch offLabel="no" onLabel="yes"
                               value="#{editFirewallEntry.isActive}"
                               id="isActive"/>
        </h:panelGrid>

        <p:panelGrid>
            <p:row>
                <p:column style="width: 25em">
                    <p:dataList var="who" id="who" value="#{editFirewallSettings.editingEntry.whos}">
                        <f:facet name="header">
                            Who
                        </f:facet>
                        <h:outputText value="#{who}"/>
                    </p:dataList>
                </p:column>
                <p:column style="width: 25em">
                    <p:dataList var="where" id="where" value="#{editFirewallEntry.wheres}">
                        <f:facet name="header">
                            Where
                        </f:facet>
                    </p:dataList>
                </p:column>
                <p:column style="width: 25em">
                    <p:dataList var="what" id="what" value="#{editFirewallEntry.whats}">
                        <f:facet name="header">
                            What
                        </f:facet>
                        <h:outputText value="#{what.asString}"/>
                    </p:dataList>
                </p:column>
            </p:row>
            <p:row>
                <p:column>
                    <p:commandButton value="New"/>
                    <p:commandButton value="Edit"/>
                    <p:commandButton value="Delete"/>
                </p:column>
                <p:column>
                    <p:commandButton value="New"
                                     action="#{editFirewallEntry.onAddWhere}"
                                     update="where dlgEditWhere"
                                     />
                    <p:commandButton value="Edit"/>
                    <p:commandButton value="Delete"/>
                </p:column>
                <p:column>
                    <p:commandButton value="New"
                                     action="#{editFirewallEntry.onAddWhat}"
                                     update="what dlgEditWhat"
                                     />
                    <p:commandButton value="Edit"/>
                    <p:commandButton value="Delete"/>
                </p:column>
            </p:row>
        </p:panelGrid>

        <p:messages showDetail="true"/>

        <p:commandButton value="OK"
                         action="#{editFirewallEntry.onOk}"
                         />
        <p:commandButton value="Cancel"
                         action="#{editFirewallEntry.onCancel}"/>
    </p:dialog>

</ui:composition>
